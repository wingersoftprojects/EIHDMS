<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./layout.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml">

    <ui:define name="content">
        <h:form>
            <p:growl/>
            <p:fieldset legend="Standard KPI Report">
                <p:panelGrid columns="9" id="grid1">
                    <p:outputLabel value="Technical Area:" for="technical_area"/>
                    <p:selectOneMenu id="technical_area" value="#{kpiBean.selectedTA}" style="width:125px" converter="technical_areaConverter" required="true" requiredMessage="Technical Area is needed">
                        <f:selectItem itemLabel="" />
                        <f:selectItems value="#{technical_areaBean.tsActive}" var="item" itemLabel="#{item.technical_area_name}" itemValue="#{item}"/>
                        <p:ajax process="@this" update="kpi"/>
                    </p:selectOneMenu>

                    <p:outputLabel value="KPI:" for="kpi"/>
                    <p:selectOneMenu id="kpi" value="#{kpiBean.selectedKPI}" style="width:125px" converter="kpiConverter" required="true" requiredMessage="KPI is needed">
                        <f:selectItem itemLabel="" />
                        <f:selectItems value="#{kpiBean.returnKpiByTA(kpiBean.selectedTA)}" var="item" itemLabel="#{item.kpi_name}" itemValue="#{item}"/>
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>

                    <p:outputLabel for="years" value="Report Period Year:" />
                    <p:selectCheckboxMenu id="years" value="#{kpiBean.selectedYears}" label="">
                        <f:selectItems value="#{kpiBean.years}" />
                    </p:selectCheckboxMenu>

                    <p:outputLabel for="district" value="District:" />
                    <p:selectCheckboxMenu id="district" value="#{kpiBean.selectedDistricts}" label="" panelStyle="width:150px" converter="districtConverter">
                        <f:selectItems value="#{kpiBean.districts}" var="ds" itemValue="#{ds}" itemLabel="#{ds.district_name}" />
                    </p:selectCheckboxMenu>

                    <h:commandButton value="Show Report" action="#{kpiBean.showReport()}" />
                </p:panelGrid>

                <p:panel id="pivotarea">
                    <!-- 1. Create a DIV container to insert the component -->
                    <div id="pivotContainer"></div>

                    <div id="pivotContainerKPI"></div>

                    <h:outputScript name="./component/flexmonster/flexmonster.js"/>
                    <!-- 3. Embed the component using flexmonster.embedPivotComponent() -->
                    <script type="text/javascript">
                        var jsonData = #{kpiBean.getjSONArray()};
                        var report = {
                            classicView: true,
                            dataSourceType: "json",
                            data: jsonData,
                            rows: [
                                {uniqueName: "District"}
                            ],
                            columns: [
                                {uniqueName: "Year", sortName: "asc"}
                            ],
                            measures: [
                                {uniqueName: "Value", format: "decimal"}
                            ],
                            formats: [
                                {
                                    name: "decimal",
                                    decimalPlaces: 1
                                }
                            ],
                            licenseKey: "Z51I-6B26G1-100W-2327-1F0M-0H0Y-2I1I-1W2C-3830-1Y33-2I2W-1Y2D-1R0L",
                            expandAll: true,
                            drillAll: true
                        };

                        var report2 = {
                            viewType: "charts",
                            chartType: "bar",
                            configuratorActive: true,
                            configuratorButton: true,
                            showChartMeasures: true,
                            showFilterInCharts: true,
                            //dataSourceType: "csv",
                            //filename: "http://www.flexmonster.com/flexmonster/data/dashboard.ocsv",
                            dataSourceType: "json",
                            data: jsonData,
                            pages: [],
                            columns: [
                                {uniqueName: "Year"},
                                {uniqueName: "District"}
                            ],
                            rows: [],
                            measures: [
                                {uniqueName: "Value"}
                            ],
                            licenseKey: "Z51I-6B26G1-100W-2327-1F0M-0H0Y-2I1I-1W2C-3830-1Y33-2I2W-1Y2D-1R0L"

                        };

                        flexmonster.embedPivotComponent("flexmonster/", "pivotContainer", "100%", "500", report, true);
                        var pivot2 = flexmonster.embedPivotComponent("flexmonster/", "pivotContainerKPI", "100%", "200", report2, true);

                    </script>
                </p:panel>
            </p:fieldset>
        </h:form>
    </ui:define>

</ui:composition>
