<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./layout.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="content">

        <h:form>
            <p:growl/>
            <p:fieldset legend="Upload" id="data_element">
                <p:panelGrid columns="8" id="upload_panel_grid">
                    <p:outputLabel for="report_form" value="Report Form:" />
                    <p:selectOneMenu id="report_form" value="#{uploadBean.report_form}" style="width:125px" required="true" requiredMessage="Field Form is Required" converter="report_formConverter">
                        <f:selectItem itemLabel="" />
                        <f:selectItems value="#{report_formBean.tsActive}" var="item" itemLabel="#{item.report_form_name}" itemValue="#{item}"/>
                        <p:ajax process="@this" update="@form"/>
                    </p:selectOneMenu>
                    <p:outputLabel for="report_form_group" value="Report Form Group:" />
                    <p:selectOneMenu id="report_form_group" value="#{uploadBean.report_form_group}" style="width:125px" required="true" requiredMessage="Report Form Group field is Required" converter="report_form_groupConverter">
                        <f:selectItem itemLabel="" />
                        <f:selectItems value="#{report_form_groupBean.getts(uploadBean.report_form)}" var="item" itemLabel="#{item.report_form_group_name}" itemValue="#{item}"/>
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel for="financial_year" value="Financial Year:" />
                    <p:selectOneMenu id="financial_year" value="#{uploadBean.financial_year}" style="width:125px" required="true" requiredMessage="Financial Year is Required" converter="financial_yearConverter">
                        <f:selectItem itemLabel="" />
                        <f:selectItems value="#{financial_yearBean.tsActive}" var="item" itemLabel="#{item.financial_year_name}" itemValue="#{item}"/>
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Calendar Year:" for="report_period_year"/>
                    <p:selectOneMenu id="report_period_year" value="#{uploadBean.report_period_year}" required="true" requiredMessage="Calendar year field is required">
                        <f:selectItem itemLabel="Select One" itemValue="" />
                        <f:selectItem itemLabel="2012" itemValue="2012" />
                        <f:selectItem itemLabel="2013" itemValue="2013" />
                        <f:selectItem itemLabel="2014" itemValue="2014" />
                        <f:selectItem itemLabel="2015" itemValue="2015" />
                        <f:selectItem itemLabel="2016" itemValue="2016" />
                        <f:selectItem itemLabel="2017" itemValue="2017" />
                        <f:selectItem itemLabel="2018" itemValue="2018" />
                        <f:selectItem itemLabel="2019" itemValue="2019" />
                        <f:selectItem itemLabel="2020" itemValue="2020" />
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Report Period Quarter:" for="report_period_quarter"/>
                    <p:selectOneMenu id="report_period_quarter" value="#{uploadBean.report_period_quarter}">
                        <f:selectItem itemLabel="Select One" itemValue="" />
                        <f:selectItem itemLabel="Q1" itemValue="1" />
                        <f:selectItem itemLabel="Q2" itemValue="2" />
                        <f:selectItem itemLabel="Q3" itemValue="3" />
                        <f:selectItem itemLabel="Q4" itemValue="4" />
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Month:" for="report_period_month" rendered="#{uploadBean.showmonthly()}"/>
                    <p:selectOneMenu id="report_period_month" value="#{uploadBean.report_period_month}" rendered="#{uploadBean.showmonthly()}">
                        <f:selectItem itemLabel="Select One" itemValue="" />
                        <f:selectItem itemLabel="01" itemValue="1" />
                        <f:selectItem itemLabel="02" itemValue="2" />
                        <f:selectItem itemLabel="03" itemValue="3" />
                        <f:selectItem itemLabel="04" itemValue="4" />
                        <f:selectItem itemLabel="05" itemValue="5" />
                        <f:selectItem itemLabel="06" itemValue="6" />
                        <f:selectItem itemLabel="07" itemValue="7" />
                        <f:selectItem itemLabel="08" itemValue="8" />
                        <f:selectItem itemLabel="09" itemValue="9" />
                        <f:selectItem itemLabel="10" itemValue="10" />
                        <f:selectItem itemLabel="11" itemValue="11" />
                        <f:selectItem itemLabel="12" itemValue="12" />
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Week:" for="report_period_week" rendered="#{uploadBean.showweekly()}"/>
                    <p:selectOneMenu id="report_period_week" value="#{uploadBean.report_period_week}" rendered="#{uploadBean.showweekly()}">
                        <f:selectItem itemLabel="Select One" itemValue="" />
                        <f:selectItem itemLabel="Week1" itemValue="1" />
                        <f:selectItem itemLabel="Week2" itemValue="2" />
                        <f:selectItem itemLabel="Week3" itemValue="3" />
                        <f:selectItem itemLabel="Week4" itemValue="4" />
                        <p:ajax process="@this"/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Report Period Start date:" for="report_period_from_date" />
                    <p:calendar id="report_period_from_date" value="#{uploadBean.report_period_from_date}" title="startdate" pattern="dd/MM/yyyy" navigator="true" size="11" required="true" requiredMessage="Start Date field is required">
                        <p:ajax event="dateSelect" process="@this"/>
                    </p:calendar>
                    <p:outputLabel value="Report Period End Date:" for="report_period_to_date" />
                    <p:calendar id="report_period_to_date" value="#{uploadBean.report_period_to_date}" title="report_period_to_date" pattern="dd/MM/yyyy" navigator="true" size="11" required="true" requiredMessage="End Date field is required">
                        <p:ajax event="dateSelect" process="@this"/>
                    </p:calendar>
                    <p:outputLabel value="Report Period Name:" for="report_period_name"/>
                    <p:inputText id="report_period_name" value="#{uploadBean.report_period_name}">
                        <p:ajax process="@this"/>
                    </p:inputText>
                    <p:outputLabel value="Upload"/>
                    <p:fileUpload id="upload" fileUploadListener="#{uploadBean.handleFileUpload}" mode="advanced"
                                  auto="true" allowTypes="/(\.|\/)(xls|xlsx)$/" update="@form" multiple="false" process="upload_panel_grid" />
                    <p:commandButton value="Load Data" rendered="#{uploadBean.interface_datas.size()>0}" action="#{uploadBean.load_interface()}" update="@form,:validationreportdialog" oncomplete="PF('validationReport').show();"/>
                </p:panelGrid>
                <!-- 1. Create a DIV container to insert the component -->
                <div id="pivotContainer"></div>
                <h:outputScript name="./component/flexmonster/flexmonster.js"/>
                <!-- 3. Embed the component using flexmonster.embedPivotComponent() -->
                <c:if  test="#{uploadBean.report_form==null or uploadBean.report_form.lowest_report_form_level=='Facility'}">
                    <script type="text/javascript">
                        var jsonData = #{uploadBean.getjSONArray()};
                        var report = {
                            classicView: true,
                            dataSourceType: "json",
                            data: jsonData,
                            rows: [
                                {uniqueName: "District"},
                                {uniqueName: "Subcounty"},
                                {uniqueName: "Facility"}
                            ],
                            columns: [
                                {uniqueName: "DataElement", sortName: "asc"}
                            ],
                            measures: [
                                {uniqueName: "DataElementValue", format: "decimal"}
                            ],
                            formats: [
                                {
                                    name: "decimal",
                                    decimalPlaces: 1
                                }
                            ], 
                            expandAll: true,
                            drillAll: true,
                            licenseKey: "Z51I-6B26G1-100W-2327-1F0M-0H0Y-2I1I-1W2C-3830-1Y33-2I2W-1Y2D-1R0L"
                        };
                        //flexmonster.expandAllData();
                        flexmonster.embedPivotComponent("flexmonster/", "pivotContainer", "100%", "500", report, true);
                    </script>
                </c:if>
                <c:if  test="#{uploadBean.report_form.lowest_report_form_level=='Parish'}">
                    <script type="text/javascript">
                        var jsonData = #{uploadBean.getjSONArray()};
                        var report = {
                            classicView: true,
                            dataSourceType: "json",
                            data: jsonData,
                            rows: [
                                {uniqueName: "District"},
                                {uniqueName: "Subcounty"},
                                {uniqueName: "Parish"}
                            ],
                            columns: [
                                {uniqueName: "DataElement", sortName: "asc"}
                            ],
                            measures: [
                                {uniqueName: "DataElementValue", format: "decimal"}
                            ],
                            formats: [
                                {
                                    name: "decimal",
                                    decimalPlaces: 1
                                }
                            ],
                            expandAll: true,
                            drillAll: true,
                            licenseKey: "Z51I-6B26G1-100W-2327-1F0M-0H0Y-2I1I-1W2C-3830-1Y33-2I2W-1Y2D-1R0L"
                        };
                        //flexmonster.expandAllData();
                        flexmonster.embedPivotComponent("flexmonster/", "pivotContainer", "100%", "500", report, true);
                    </script>
                </c:if>
                <c:if  test="#{uploadBean.report_form.lowest_report_form_level=='District'}">
                    <script type="text/javascript">
                        var jsonData = #{uploadBean.getjSONArray()};
                        var report = {
                            classicView: true,
                            dataSourceType: "json",
                            data: jsonData,
                            rows: [
                                {uniqueName: "District"}
                            ],
                            columns: [
                                {uniqueName: "DataElement", sortName: "asc"}
                            ],
                            measures: [
                                {uniqueName: "DataElementValue", format: "decimal"}
                            ],
                            formats: [
                                {
                                    name: "decimal",
                                    decimalPlaces: 1
                                }
                            ],
                            expandAll: true,
                            drillAll: true,
                            licenseKey: "Z51I-6B26G1-100W-2327-1F0M-0H0Y-2I1I-1W2C-3830-1Y33-2I2W-1Y2D-1R0L"
                        };
                        //flexmonster.expandAllData();
                        flexmonster.embedPivotComponent("flexmonster/", "pivotContainer", "100%", "500", report, true);
                    </script>
                </c:if>
            </p:fieldset>
        </h:form>

        <ui:include src="dialog_validationreport.xhtml"/>
        <p:ajaxStatus style="display:block;margin-bottom:2em;height:24px;">
            <f:facet name="default">
                <h:outputText value="Status: StandBy" />
            </f:facet>

            <f:facet name="start">

            </f:facet>

            <f:facet name="complete">
                <h:outputText value="Status: Completed" />
            </f:facet>
        </p:ajaxStatus>

        <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />

        <p:dialog widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
            <p:graphicImage name="/images/ajax-loader.gif" />
        </p:dialog>
    </ui:define>

</ui:composition>
